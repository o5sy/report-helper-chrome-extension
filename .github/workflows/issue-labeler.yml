name: Issue Auto Labeler

on:
  issues:
    types: [opened, edited]

jobs:
  label-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Auto label issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = issue.body ? issue.body.toLowerCase() : '';
            const labels = [];

            // ì´ìŠˆ íƒ€ìž… ë¶„ë¥˜
            if (title.includes('bug') || title.includes('error') || title.includes('ë¬¸ì œ') || 
                title.includes('ì˜¤ë¥˜') || body.includes('ë²„ê·¸') || body.includes('ì—ëŸ¬')) {
              labels.push('bug');
            } else if (title.includes('feature') || title.includes('ê¸°ëŠ¥') || title.includes('ì¶”ê°€') ||
                       title.includes('ê°œì„ ') || body.includes('ê¸°ëŠ¥') || body.includes('feature')) {
              if (title.includes('ê°œì„ ') || body.includes('ê°œì„ ') || body.includes('í–¥ìƒ')) {
                labels.push('enhancement');
              } else {
                labels.push('feature-request');
              }
            } else if (title.includes('question') || title.includes('ì§ˆë¬¸') || title.includes('ë¬¸ì˜') ||
                       title.includes('how to') || title.includes('ì–´ë–»ê²Œ')) {
              labels.push('question');
            } else if (title.includes('docs') || title.includes('ë¬¸ì„œ') || title.includes('documentation')) {
              labels.push('documentation');
            }

            // ìš°ì„ ìˆœìœ„ ë¶„ë¥˜
            if (title.includes('urgent') || title.includes('critical') || title.includes('ê¸´ê¸‰') ||
                title.includes('ì¹˜ëª…ì ') || body.includes('urgent') || body.includes('critical')) {
              labels.push('priority/critical');
            } else if (title.includes('important') || title.includes('ì¤‘ìš”') || 
                       body.includes('important') || body.includes('ì¤‘ìš”')) {
              labels.push('priority/high');
            } else if (title.includes('minor') || title.includes('ìž‘ì€') || 
                       body.includes('minor') || body.includes('ìž‘ì€')) {
              labels.push('priority/low');
            } else {
              labels.push('priority/medium');
            }

            // ì»´í¬ë„ŒíŠ¸ ë¶„ë¥˜ (ë³¸ë¬¸ ë‚´ìš© ê¸°ë°˜)
            if (body.includes('content script') || body.includes('ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸') ||
                body.includes('content-script') || body.includes('google sheets')) {
              labels.push('component/content-script');
            }
            if (body.includes('popup') || body.includes('íŒì—…') || body.includes('ui') ||
                body.includes('interface') || body.includes('ì¸í„°íŽ˜ì´ìŠ¤')) {
              labels.push('component/popup');
            }
            if (body.includes('background') || body.includes('ë°±ê·¸ë¼ìš´ë“œ') ||
                body.includes('service worker')) {
              labels.push('component/background');
            }
            if (body.includes('api') || body.includes('gemini') || body.includes('gmail') ||
                body.includes('google sheets api')) {
              labels.push('component/api');
            }

            // íŠ¹ë³„í•œ í‚¤ì›Œë“œ ê¸°ë°˜ ë¼ë²¨
            if (body.includes('security') || body.includes('ë³´ì•ˆ') || 
                body.includes('vulnerability') || body.includes('ì·¨ì•½ì ')) {
              labels.push('security');
            }
            if (body.includes('performance') || body.includes('ì„±ëŠ¥') || 
                body.includes('slow') || body.includes('ëŠë¦°')) {
              labels.push('performance');
            }
            if (body.includes('accessibility') || body.includes('ì ‘ê·¼ì„±') || 
                body.includes('a11y')) {
              labels.push('accessibility');
            }

            // ê¸°ë³¸ ìƒíƒœ ë¼ë²¨
            labels.push('status/triage');

            // ì¤‘ë³µ ì œê±°
            const uniqueLabels = [...new Set(labels)];

            // ë¼ë²¨ ì ìš©
            if (uniqueLabels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: uniqueLabels
              });
              
              // ë¼ë²¨ë§ ì™„ë£Œ ëŒ“ê¸€
              const labelList = uniqueLabels.map(l => `\`${l}\``).join(', ');
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ðŸ·ï¸ **ìžë™ ë¼ë²¨ë§**: ë‹¤ìŒ ë¼ë²¨ë“¤ì´ ìžë™ìœ¼ë¡œ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤: ${labelList}`
              });
            }

            // ë²„ê·¸ ë¦¬í¬íŠ¸ì¸ ê²½ìš° ì¶”ê°€ ê°€ì´ë“œ
            if (labels.includes('bug')) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ðŸ› **ë²„ê·¸ ë¦¬í¬íŠ¸ ê°€ì´ë“œ**: 
                
                ë¹ ë¥¸ í•´ê²°ì„ ìœ„í•´ ë‹¤ìŒ ì •ë³´ë¥¼ ì¶”ê°€ë¡œ ì œê³µí•´ì£¼ì‹œë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤:
                - Chrome ë¸Œë¼ìš°ì € ë²„ì „
                - ìš´ì˜ì²´ì œ (Windows/Mac/Linux)
                - ìž¬í˜„ ë‹¨ê³„ (ë‹¨ê³„ë³„ë¡œ ìƒì„¸ížˆ)
                - ì˜ˆìƒ ê²°ê³¼ vs ì‹¤ì œ ê²°ê³¼
                - ìŠ¤í¬ë¦°ìƒ· (ê°€ëŠ¥í•œ ê²½ìš°)
                - ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ ë©”ì‹œì§€ (F12 > Console íƒ­)`
              });
            }
